openapi: 3.0.0
info:
  title: API de Gestão de Biblioteca - inf25dw1g02
  description: |
    API RESTful para gerir os recursos de uma Biblioteca Digital, desenvolvida em Node.js e MySQL.
    A API cumpre os requisitos de Arquitetura REST, CRUD (4 verbos HTTP), e utiliza JSON.
  version: 1.0.0
servers:
  - url: http://localhost:8080/api 
    description: Servidor de Desenvolvimento Local (A porta 8080 mapeia para a porta 3000 do container Node.js)

paths:
  /autores:
    get:
      tags: ["Autores"]
      summary: Mostra todos os Autores 
      responses:
        '200':
          description: Lista de autores devolvida com sucesso.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Autor'
    post:
      tags: ["Autores"]
      summary: Cria um novo Autor 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutorInput'
      responses:
        '201':
          description: Autor criado com sucesso.
  
  /autores/{id}:
    get:
      tags: ["Autores"]
      summary: Obtém um Autor pelo ID 
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Autor encontrado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Autor'
        '404':
          description: Autor não encontrado.
    put:
      tags: ["Autores"]
      summary: Atualiza um Autor existente 
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutorInput'
      responses:
        '200':
          description: Autor atualizado com sucesso.
    delete:
      tags: ["Autores"]
      summary: Elimina um Autor 
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Autor eliminado com sucesso.

  /livros:
    get:
      tags: ["Livros"]
      summary: Mostra todos os Livros (Suporta filtro por Autor)
      description: Requisito Valorizado: Filtros através de parâmetros HTTP (id_autor).
      parameters:
        - name: id_autor
          in: query
          description: Filtra livros pelo ID do autor (Chave Estrangeira).
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Lista de livros devolvida.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Livro'
    post:
      tags: ["Livros"]
      summary: Adiciona um novo Livro
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LivroInput'
      responses:
        '201':
          description: Livro adicionado com sucesso.

  /utilizadores:
    get:
      tags: ["Utilizadores"]
      summary: Mostra todos os Utilizadores 
      responses:
        '200':
          description: Lista de utilizadores devolvida com sucesso.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Utilizador'
    post:
      tags: ["Utilizadores"]
      summary: Cria um novo Utilizador 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UtilizadorInput'
      responses:
        '201':
          description: Utilizador criado com sucesso.

/emprestimos:
    get:
      tags: ["Empréstimos"]
      summary: Mostra todos os Empréstimos
      responses:
        '200':
          description: Lista de empréstimos devolvida com sucesso.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Emprestimo'
    post:
      tags: ["Empréstimos"]
      summary: Cria um novo Empréstimo
      description: Cria um registo de empréstimo com a data atual.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmprestimoInput'
      responses:
        '201':
          description: Empréstimo registado com sucesso.
  
  /emprestimos/{id}:
    put:
      tags: ["Empréstimos"]
      summary: Atualiza um Empréstimo (Registar Devolução)
      description: Principalmente usado para registar a data de devolução de um livro.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                data_devolucao:
                  type: string
                  format: date
                  description: Data em que o livro foi devolvido (YYYY-MM-DD).
      responses:
        '200':
          description: Devolução registada com sucesso.
    delete:
      tags: ["Empréstimos"]
      summary: Elimina um Empréstimo
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Empréstimo eliminado com sucesso.

components:
  schemas:
    Autor:
      type: object
      properties:
        id: { type: "integer", readOnly: true, description: "ID único do autor." }
        nome: { type: "string" }
        nacionalidade: { type: "string" }
    AutorInput:
      type: object
      required: ["nome"]
      properties:
        nome: { type: "string" }
        nacionalidade: { type: "string" }
    Utilizador:
      type: object
      properties:
        id: { type: "integer", readOnly: true }
        nome: { type: "string" }
        email: { type: "string" }
        numero_estudante: { type: "string" }
    UtilizadorInput:
      type: object
      required: ["nome", "email", "numero_estudante"]
      properties:
        nome: { type: "string" }
        email: { type: "string" }
        numero_estudante: { type: "string" }
        Livro:
      type: object
      properties:
        id: { type: "integer", readOnly: true }
        titulo: { type: "string" }
        ano_publicacao: { type: "integer" }
        id_autor: { type: "integer", description: "ID do autor (Foreign Key)." }
    LivroInput:
      type: object
      required: ["titulo", "id_autor"]
      properties:
        titulo: { type: "string" }
        ano_publicacao: { type: "integer" }
        id_autor: { type: "integer" }
         Emprestimo:
      type: object
      properties:
        id: { type: "integer", readOnly: true }
        id_livro: { type: "integer" }
        id_utilizador: { type: "integer" }
        data_emprestimo: { type: "string", format: "date" }
        data_devolucao: { type: "string", format: "date", nullable: true }
    EmprestimoInput:
      type: object
      required: ["id_livro", "id_utilizador"]
      properties:
        id_livro: { type: "integer" }
        id_utilizador: { type: "integer" }